{% load pipeline %}
{% load static %}
<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>Healthsites.io</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.css" rel="stylesheet"
          type="text/css" media="screen, projection"/>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" type="text/css"
          media="screen, projection"/>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet"
          type="text/css" media="screen, projection"/>
    <link href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" rel="stylesheet" type="text/css"
          media="screen, projection"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.2.3/leaflet.draw.css" rel="stylesheet"
          type="text/css" media="screen, projection"/>
    <link href='https://fonts.googleapis.com/css?family=Raleway:300,400,700,500,300' rel='stylesheet' type='text/css'>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css" rel="stylesheet" type="text/css"
          media="screen, projection"/>
    {% stylesheet 'project' %}
    {% stylesheet 'map_page' %}


    <link href='https://fonts.googleapis.com/css?family=Raleway:300,400,700,500,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:400,400italic,300,500,500italic,700' rel='stylesheet'
          type='text/css'>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->

    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

    <!--[if lt IE 9]>

      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>

      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>

    <![endif]-->

</head>
<script>
    var isLoggedIn = false;
    {% if user.is_authenticated %}
        isLoggedIn = true;
    {% endif %}
</script>
<body class="map-page">
<nav class="navbar navbar-fixed-top masthead no-tag">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{% url "home" %}">
                <span class="hs-logo"></span>healthsites.io
            </a>
            <a class="navbar-share closed" href="#">
                <img class="share" src="{% static "img/share.svg" %}" width="20"/>
                <img class="close" src="{% static "img/close.svg" %}" width="16"/>
            </a>

            <div class="hidden" id="site-social" style="width: 115px;">
                <i class="medium-size-icon mdi-content-clear" id="site-social-icon-open"></i>
                <a onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"
                   class="withripple twitter-href">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-hs-share withripple facebook-href">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="googleplus-href"
                   onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
                    <i class="fa fa-google-plus"></i>
                </a>
            </div>
            <span class="tagline">A free, curated, global, canonical source of healthcare location data</span>
        </div>
        <div id="navbar" class="collapse navbar-collapse pull-right">
            <ul class="nav navbar-nav">
                <li><a href="/#about">About</a></li>
                <li><a href="{% url "map" %}">Map</a></li>
                <li><a href="/#country-data">Country data</a></li>
                <li><a href="/#lifecycle">How it works</a></li>
                <li><a href="/#share-data">Share data</a></li>
                <li><a href="/#partners">Partners</a></li>
                <li><a class="navbar-search" href="#"><i class="fa fa-search"></i></a></li>
                <li><a class="navbar-chat" href="https://gitter.im/healthsites/healthsites"><i
                        class="fa fa-comments"></i></a></li>
            </ul>
        </div>
        <!--/.nav-collapse -->

    </div>

    <div class="nav-searchbar container-fluid">
        <form action="map" method="POST">
            <div class="option-group">
                <div class="option"><span></span><input type="radio" name="option" id="radio-healthsite"
                                                        value="healthsite" checked><span></span><label class="option"
                                                                                                       for="radio-healthsite">healthsite</label>
                </div>
                <div class="option"><span></span><input type="radio" name="option" id="radio-place"
                                                        value="place"><span></span><label class="option"
                                                                                          for="radio-healthsite">place</label>
                </div>
            </div>
            <input id="search-box" type="search" name="q" placeholder="search..."><input type="submit" value="search">
        </form>
    </div>
</nav>

<section id="map-full" class="js-fullheight fluid-container">
    <form id="locality-form" action="localities/edit" method="post">
        {% csrf_token %}
        <div class="location-info pad0x col-md-4">
            <div class="profile">
                {% if user.is_authenticated %}
                    <div class="person col-xs-8 pad0x">
                        <div class="avatar-holder">
                            <img src="{% static "img/av-holder.svg" %}" class="frame" width="48" height="48"/>
                            <img src="http://pbs.twimg.com/profile_images/2284174872/7df3h38zabcvjylnyfe3_normal.png"/>
                        </div>

                    <span class="name">
                        <a href="{% url 'userprofilepage' %}">{{ user }}</a>
                    </span>
                    </div>
                    <a href="{% url 'logout_user' %}" class="button col-xs-4 pad0x blue stroke"><i
                            class="fa fa-sign-out"></i> sign out</a>
                {% else %}
                    <div class="person col-xs-8 pad0x">
                <span class="name">
                        You are not signed in
                    </span>
                    </div>
                    <a href="{% url 'usersignpage' %}" class="button col-xs-4 pad0x blue stroke"><i
                            class="fa fa-sign-in"></i> sign in</a>
                {% endif %}

                <div style="clear: both;"></div>
            </div>
            <div class="details" id="sidebar-info">
                <div class="header">
                    <h1 id="locality-name">No Name</h1>
                    <input type="text" id="locality-name-input" name="locality-name"
                           placeholder="Locality name" style="display: none; width: 100%"/>

                    <p class="sub" id="locality-nature-of-facility">first referral hospital</p>

                    <p style="margin-top: 5px">
                        <select id="locality-nature-of-facility-input" name="nature-of-facility" style="display: none">
                        </select>
                    </p>
                </div>
                <div class="info">
                    <div id="line-updates" class="line updates">
                        <div class="icon-holder">
                            <i class="fa fa-info-circle"></i>
                        </div>
                        <div class="data">
                            <p>last update: <span class="date">11 may 2015</span>, by
                            <span class="name">
                                <a href="profile/sharehealthdata">@sharehealthdata</a>
                            </span>
                            <span class="more">
                                <a href="#" class="full-list">see full list <i class="fa fa-angle-down"></i></a>
                            </span>
                            </p>

                            <div class="progress">
                                <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="70"
                                     aria-valuemin="0" aria-valuemax="100" style="width:90%" id="locality-completeness">
                                    90% Complete
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="line find">
                        <div class="icon-holder">
                            <i class="fa fa-map-marker"></i>
                        </div>
                        <div class="data">
                            <p class="address" id="locality-physical-address">54, Praed st, London, W2 NY<br/>
                                Unighted Kingdom</p>
                            <input type="text" id="locality-physical-address-input" name="physical-address"
                                   placeholder="Physical Address" style="display: none"/>

                            <p class="coordinates" id="locality-coordinates">lat: 0, long: 0</p>

                            <p class="coordinates" id="locality-coordinates-input" style="display: none">lat: <input
                                    type="number"
                                    id="locality-coordinates-lat-input"
                                    style="width: 80px"
                                    min="-180" max="180" onchange="onChange(this)"/>,
                                long: <input type="number"
                                             id="locality-coordinates-long-input" style="width: 80px" min="-180"
                                             max="180" onchange="onChange(this)"/></p>


                            <p>
                                <i class="fa fa-phone"></i>
                                <span id="locality-phone" class="call">0141 636 6116</span>
                                <span><input type="text" id="locality-phone-input" name="phone"
                                             placeholder="Phone" style="display: none"/></span>
                            </p>

                            <p>
                                <i class="fa fa-clock-o"></i>
                                <span id="locality-operation" class="call">24/24 & 7/7</span>
                                <span>
                                    <select id="locality-operation-input"
                                            style="display: none" onchange="onChange(this)">
                                    </select>
                                </span>
                                <input type="text" id="locality-operation-specify-input"
                                       placeholder="Operations" style="display: none"/>
                            </p>

                            <p class="url">
                                <i class="fa fa-link"></i>
                                <a href="#" id="locality-url">www.msf.org</a>
                            </p>
                        </div>
                    </div>
                    <div class="line services">
                        <div class="icon-holder">
                            <i class="fa fa-tags"></i>
                        </div>
                        <div class="data">
                            <div class="scope-of-service">
                                <h3>scope of service <span id="locality-scope-of-service-add"
                                                           class="add_remove_optional_button " style="display: none"
                                                           onclick="addOption('scope')">+</span>
                                </h3>

                                <div id="locality-scope-of-service">
                                </div>
                                <div id="locality-scope-of-service-input"
                                     style="display: none">
                                </div>
                            </div>
                            <div class="ancillary">
                                <h3>ancillary services <span id="locality-ancillary-service-add"
                                                             class="add_remove_optional_button " style="display: none"
                                                             onclick="addOption('ancillary')">+</span></h3>

                                <div id="locality-ancillary-service">
                                </div>
                                <div id="locality-ancillary-service-input"
                                     style="display: none">
                                </div>
                            </div>
                            <div class="activities">
                                <h3>activities <span id="locality-activities-add"
                                                     class="add_remove_optional_button " style="display: none"
                                                     onclick="addOption('activities')">+</span></h3>

                                <div id="locality-activities">
                                </div>
                                <div id="locality-activities-input"
                                     style="display: none">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="line beds">
                        <div class="icon-holder">
                            <i class="fa fa-bed"></i>
                        </div>
                        <div class="data">
                            <p id="locality-inpatient-service"></p>

                            <p id="locality-inpatient-service-input" style="display: none"><input type="number"
                                                                                                  id="locality-inpatient-service-full-input"
                                                                                                  min="0"
                                                                                                  style="width: 50px"
                                                                                                  placeholder="Full Time"/>
                                full
                                time beds, <input type="number" id="locality-inpatient-service-part-input" min="0"
                                                  style="width: 50px" placeholder="Part Time"/>
                                part time beds</p>
                        </div>
                    </div>
                    <div class="line note">
                        <div class="icon-holder">
                            <i class="fa fa-sticky-note"></i>
                        </div>
                        <div class="data">
                            <p><strong>Note:</strong> Outpatient consultation and in-patient hospitalization</p>
                        </div>
                    </div>
                    <div class="line doctors">
                        <div class="icon-holder">
                            <i class="fa fa-user-md"></i>
                        </div>
                        <div class="data">
                            <p id="locality-staff"></p>

                            <p id="locality-staff-input" style="display: none"><input type="number"
                                                                                      id="locality-staff-doctor-input"
                                                                                      min="0"
                                                                                      style="width: 50px"
                                                                                      placeholder="Doctor"/>
                                full time equivalent doctors and <input type="number" id="locality-staff-nurse-input"
                                                                        min="0"
                                                                        style="width: 50px" placeholder="Nurse"/>
                                full time equivalent
                                nurses</p>
                        </div>
                    </div>
                    <div class="line ownership">
                        <div class="icon-holder">
                            <i class="fa fa-briefcase"></i>
                        </div>
                        <div class="data">
                            <p><strong>Ownership:</strong>
                                <span id="locality-ownership"></span>
                                <select id="locality-ownership-input" name="ownership"
                                        style="display: none">
                                </select></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="buttons col-md-4 col-sm-12 col-xs-12">
                <div class="button-wrapper col-xs-4">
                    <a id="twitter_share_map" class="button share stroke blue">
                        <i class="fa fa-twitter"></i> share
                    </a>
                </div>
                <div class="button-wrapper col-xs-4" id="edit-button">
                    <a class="button edit stroke blue"
                       style="cursor: pointer"><i
                            class="fa fa-pencil"></i> edit
                    </a>
                </div>
                <div class="button-wrapper col-xs-4" id="save-button" style="display: none">
                    <a class="button edit stroke blue"
                       style="cursor: pointer"><i
                            class="fa fa-pencil"></i> save
                    </a>
                </div>
                <div class="button-wrapper col-xs-4" id="create-button" style="display: none">
                    <a class="button edit stroke blue"
                       style="cursor: pointer"><i
                            class="fa fa-pencil"></i> create
                    </a>
                </div>
                <div class="button-wrapper col-xs-4" id="add-button">
                    <a class="button add" style="cursor: pointer">
                        <i class="fa fa-plus"></i> add new
                    </a>
                </div>
                <div class="button-wrapper col-xs-4" id="cancel-button" style="display: none">
                    <a class="button edit stroke blue"
                       style="cursor: pointer"><i
                            class="fa fa-pencil"></i> cancel
                    </a>
                </div>
            </div>
        </div>
        <div class="map-page pad0x col-md-8">
            <div id="map">
            </div>
        </div>
    </form>
</section>
<script type="text/javascript" src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
{#<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>#}
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.7/d3.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>
<script type="text/javascript" src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script type="text/javascript"
        src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.2.3/leaflet.draw-src.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/js-signals/1.0.0/js-signals.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/hasher/1.2.0/hasher.min.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/crossroads/0.12.2/crossroads.min.js"></script>

{% javascript 'project' %}
{% javascript 'map_page' %}
{% javascript 'map_app' %}

{% block extra_js %}
    <script type="text/javascript">
        var APP;
        $(document).ready(function () {
            // set share url
            var baseURL = location.protocol + "//" + location.hostname + "/";
            $(".twitter-href").attr("href", "https://twitter.com/intent/tweet?text=Share and develop critical health facility data on " + baseURL);
            $(".facebook-href").attr("href", "https://www.facebook.com/sharer/sharer.php?u=" + baseURL);
            $(".googleplus-href").attr("href", "https://plus.google.com/share?url=" + baseURL);

            // Set viewport if exist
            {% if northeast_lat and northeast_lng and southwest_lat and southwest_lng %}
                console.log({{ northeast_lat }} +" " + {{ northeast_lng }} +" " + {{ southwest_lat }} +" " + {{ southwest_lng }});
                sessionStorage.setItem('northeast_lat', {{ northeast_lat }});
                sessionStorage.setItem('northeast_lng', {{ northeast_lng }});
                sessionStorage.setItem('southwest_lat', {{ southwest_lat }});
                sessionStorage.setItem('southwest_lng', {{ southwest_lng }});
            {% endif %}

            // initialize the app
            new APP();
        });
        function addOption(wrapper) {
            $APP.trigger('sidebar.add-option', {'wrapper': wrapper});
        }
        function onChange(element) {
            $APP.trigger('sidebar.option-onchange', {'element': element});
        }

        $('body').on("click", ".remove_option", function (e) { //user click on remove text
            e.preventDefault();
            $(this).parent('div').remove();
        });
    </script>
{% endblock extra_js %}

<div id="ribbon"><img class="share" src="static/img/ribbon.png" width="70" height="105" alt="now in beta"/></div>
</body>
</html>